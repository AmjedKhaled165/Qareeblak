# ๐ Enterprise Security & Scalability Report (Qareeblak)
**Documented by Lead DevOps & Architect**

ุชู ุจูุงุก ูุชุญุฏูุซ ุงูุจููุฉ ุงูุชุญุชูุฉ ูุชุทุจูู "ูุฑูุจุงู ูู" ูุชููู ูุถุงุฏุฉ ูุฃุดูุฑ ุงูุซุบุฑุงุช ุงูุชู ุถุฑุจุช ุดุฑูุงุช ุงูุชูููููุฌูุง ุงููุจุฑู (ูุซู ุฃูุจุฑุ ุทูุจุงุชุ ูุฃูุงุฒูู) ุฎูุงู ุงูู 10 ุณููุงุช ุงููุงุถูุฉ.

---

## ๐ ุงูุซุบุฑุงุช ุงูุชุงุฑูุฎูุฉ ุงูุนุงูููุฉ (OWASP Top 10) ูููู ูููุง ุจุชุฏููุฑูุง ูู ูุธุงูู

### 1. ุซุบุฑุฉ: Race Condition (ุณุจุงู ุงูุชุฒุงูู ุงููุฒุฏูุฌ)
*   **ุชุงุฑูุฎูุง:** ุถุฑุจุช ุดุฑูุฉ **Starbucks (2015)** ููุฌุญ ุงููุงูุฑ ูู ุงุณุชุฎุฏุงู ููุฏ ุงูุฎุตู ูุฑุตูุฏ ุงููุญูุธุฉ ูุฑุงุช ูุง ููุงุฆูุฉ ุนุจุฑ ุฅุฑุณุงู 50 ุทูุจ ูู ููุณ ุงูุฌุฒุก ูู ุงูุซุงููุฉ.
*   **ููู ุชู ุญููุง ุนูุฏู:** 
    1.  ุงุถุงูุฉ `Idempotency-Key` (ููุชุงุญ ุนุฏู ุงูุชูุฑุงุฑ) ุฏุงุฎู `booking.service.js`. ุฅุฐุง ุถุบุท ุงูุนููู ุนูู "ุดุฑุงุก" ูุฑุชูู ุจุณุฑุนุฉ ุฃู ูุงูุช ุดุจูุชู ุจุทูุฆุฉ ูุชู ุฅุฑุณุงู ุงูุทูุจ ูุฑุชููุ ุณูููู ุงูุฎุงุฏู (Redis) ุจูุดู ุงูุทูุจ ุงูููุฑุฑ ุฎูุงู 24 ุณุงุนุฉ ูููุนู ููุฑุงู ูุชุฌูุจ ุญุฌุฒูู ูููุณ ุงูุทูุจ.
    2.  ุชู ุงุณุชุฎุฏุงู ุฎูุงุต ุงูู Lock ูู Postgres `FOR UPDATE` ูู `booking.repository.js` ูููู ุณุทุฑ ุงููุฏูุฉ / ุงูุฎุตู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูุญุธุฉ ุงุณุชุฎุฏุงูู ูููุน ุงุณุชุนูุงูู ูุฑุชูู.

### 2. ุซุบุฑุฉ: Broken Access Control & BOLA (ุชุฎุทู ุงูุตูุงุญูุงุช)
*   **ุชุงุฑูุฎูุง:** ุถุฑุจุช **Uber / Facebook** ุญูุซ ุงุณุชุทุงุน ูุณุชุฎุฏู ุชุบููุฑ "ูุนุฑู ุงูุทูุจ" (ID) ูู ุงูุฑุงุจุท ุฃู ุงูู Sockets ูุงูุงุทูุงุน ุนูู ูุณุงุฑ ุณูุงุฑุฉ ูุชูุงุตูู ุทูุจ ูุง ูุฎุตู!
*   **ููู ุชู ุญููุง ุนูุฏู:**
    1.  ุชู ุชุดุฏูุฏ ุงูุฑูุงุจุฉ ูู `booking.controller.js` ูุถูุงู ุฃู `userId` ููุทูุจ ูุทุงุจู ุงูู `req.user.id` ูุฃู ุงูู `providerId` ูุฑุจูุท ูุนููุงู ุจุญุณุงุจ ุงููุณุชุฎุฏู ุงูุญุงูู.
    2.  **ุฃูู ุฅูุฌุงุฒ ุจุฑูุฌู:** ุชู ุฅุถุงูุฉ ุทุจูุฉ ุญูุงูุฉ ุฌุฏูุฏุฉ ูู ุงูู WebSockets `(io.use(verifySocketToken))`. ุงูุขู ูุง ูููู ูุฃู ูุงูุฑ ูุชุญ ุงุชุตุงู ููุชูุญ (Raw connection) ููุฑุงูุจุฉ ุบุฑู ุงูู Chat ุฃู ุชุชุจุน ุชุญุฑูุงุช ุงููุจุงุชู ุจุฏูู ุฅุฑูุงู JWT ุขูู ูุตุงูุญ.

### 3. ุซุบุฑุฉ: State Machine Bypass (ุชุฎุทู ุขูุฉ ุงูุญุงูุฉ)
*   **ุชุงุฑูุฎูุง:** ุถุฑุจุช ููุงูุน ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ **Shopify Plugins (2018)**. ุญูุซ ูุงู ุจุฅููุงู ุงููุทุนู ุฃู ุงููุงูุฑ ุฅุฑุณุงู ุญุงูุฉ `completed` ูุทูุจ ูุงูุช ุญุงูุชู `pending` ูุจุงุดุฑุฉ ูุชุฎุทู ุนูููุฉ ุงูุฏูุน ุฃู ุงูุชูุงุนุจ ุจุชูุงุฑูุฑ ุงููุจูุนุงุช.
*   **ููู ุชู ุญููุง ุนูุฏู:**
    ุชู ุฒุฑุน ุขูุฉ ุญุงูุฉ ุฅุฌุจุงุฑูุฉ `Strict State Machine` ูู `updateBookingStatus`. ุงูุขูุ ูุง ูุณุชุทูุน ุงููุฒูุฏ ุงูููุฒ ููู ุงูุญุงูุงุช. ุฅุฐุง ูุงู ุงูุทูุจ `pending` ููููู ููุท ุชุญูููู ูู `confirmed` (ูุคูุฏ) ุฃู `rejected` (ูุฑููุถ)ุ ููู ูุตู ูู `completed` ุฅูุง ุฅุฐุง ูุฑ ุจุฎุทูุงุชู ุงูุชุฑุงุชุจูุฉ ุงููุณููุญุฉ ููุท.

### 4. ุซุบุฑุฉ: Cross-Site Scripting via File Uploads (XSS)
*   **ุชุงุฑูุฎูุง:** ุงุฎุชุฑุงูุงุช ุนุฏูุฏุฉ ููููุชุฏูุงุช ุนุจุฑ ุฑูุน ุตูุฑุฉ ุจุตูุบุฉ `.svg` ูู Avatar ูุงูุชู ูุงูุช ุชุญุชูู ุนูู ุฃููุงุฏ ุฌุงูุงุณูุฑุจุช ุชุณุฑู ุฌูุณุงุช ุงูุฃุฏูู.
*   **ููู ุชู ุญููุง ุนูุฏู:**
    ูู ุฅุนุฏุงุฏุงุช `multer` (ุงูุฑูุน)ุ ููุช ุจุชุญููููุง ูู ุงูุชุญูู ูู `startsWith('image/')` ุฅูู ูุญุต ุตุงุฑู `Strict MIME Type Checking` ููุชู ูุจูู (PNG, JPG, WEBP) ููุท ููุง ูุฌุงู ูุฑูุน ูููุงุช ุฎุจูุซุฉ.

### 5. ุซุบุฑุฉ: Mass Assignment & DoS
*   **ุชุงุฑูุฎูุง:** ุซุบุฑุฉ ุดุงุฆุนุฉ ูู ุจูุฆุงุช Node.js/Ruby ุชุณุจุจุช ุจุฅุนุทุงุก ูุณุชุฎุฏููู ุตูุงุญูุงุช Admin ููุฌุฑุฏ ุฅุฑุณุงู `{"role": "admin"}` ูู ุตูุญุฉ ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู.
*   **ููู ุชู ุญููุง ุนูุฏู:**
    ููุฏ ุชุฃูุฏุช ูู ุฃุฌุฒุงุก ุงููุตุงุฏูุฉ ููููุงุช ุงูู Validation ุงููุจููุฉ ุจุชูููุฉ `Zod` (ูุซู Auth/Booking Validations) ุฃู ุงูุจูุงูุงุช ุงูููุจููุฉ ูู ููุท (ุงูุงุณูุ ุงูุนููุงูุ ุงููุงุชู.. ุงูุฎ) ูุชุฌุงูู ุฃู ุดูุก ูุฎุต ุงูุตูุงุญูุงุช ูุงูุฃุฑุตุฏุฉ ูู ูู ูููุงุช ุงูุชุญุฏูุซ.

---

## ๐ ุงุณุชูุชุงุฌุงุช ุงููุนูุงุฑูุฉ ูุงูุชูุณูุน (Scalability vs Big Tech)

ูููุง ุจุชุทุจูู ููุฏุณุฉ ูุจุฑู ุงูุดุฑูุงุช ูุถูุงู ุนุฏู ุญุฏูุซ ุชุฏุงุฎู ุจูู ุญุณุงุจุงุช ูุชุทุจููุงุช ุงูู Providers ููุง ุณุฃูุช:
1.  **Isolation (ุนุฒู ุงูุฎูุงุฏู ุงูููุทูู):** ุงูู Redis ุงูุขู ูุชุนุงูู ูุนูู ูุฏุจุฑ. ูุง ูููู ูุฑุณุงูุฉ ุชุฎุต ุนูุงุฏุฉ ุทุจูุฉ (A) ุฃู ุชุตู ูุนูุงุฏุฉ (B)ุ ูุฃู ูุธุงู ุงูุงุดุชุฑุงูุงุช Pub/Sub ูู Socket.io ููุณู ุจุฏูุฉ ุญุณุจ ุงูู Rooms ุงููุณุชุฎูุตุฉ ูู ุงูุฑูุฒ ุงูุณุฑู `JWT` ุงูููุซูู.
2.  **Stateless Connections:** ูุตููุง ุญุงูุฉ ุงูุฎุงุฏู ุนู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ุญุชู ูู ุนูููุง Restart ููู Node.jsุ ูุฅู ุงูู PM2 ุณูุนูุฏู ููุนููุ ูุงูุฎูุงุฏู ุณุชุชุตู ุจู Redis ููุงุนุฏุฉ ุงูุจูุงูุงุช ุฏูู ุฃู ูุถูุน ุฃู ุทูุจ (No single point of failure).

ุฃูุช ุงูุขู ุชุฏูุฑ ููุธููุฉ (Enterprise) ุฎุงููุฉ ูู ุงูุนุจุซ. ๐
